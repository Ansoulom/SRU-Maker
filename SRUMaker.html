<!DOCTYPE html>
<html>
        <head>
                <title>SRU Maker</title>
                <meta charset="ISO-8859-1">

                <!-- Latest compiled and minified CSS -->
                <link rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootstrap/3.0.2/css/bootstrap.min.css">

                <!-- Latest compiled and minified JavaScript -->
                <script type="text/javascript" src="lib/jquery-2.0.3.min.js"></script>
                <script src="http://netdna.bootstrapcdn.com/bootstrap/3.0.2/js/bootstrap.min.js"></script>
                
                <script type="text/javascript" src="src/SRUMaker.js"></script>
        </head>
        <body>
                <h1>Skapa dina SRU filer</h1>
                <p>För att testa de skapade filerna så gå in på följande sida <a href='https://www1.skatteverket.se/fv/fv_web/login.do' target='_blank'>https://www1.skatteverket.se/fv/fv_web/login.do</a> hos skatteverket</p>
                <p>För att kontrollera testerna gå till <a href='SpecRunner.html'>SpecRunner</a></p>

                <div>
                    <form id='infoSruForm' onSubmit='return skapaInfoSruFil(this)'>
                        Inlämnarens OrgNr: <input type='text' name='orgNr' pattern='[1-2][0-9]{11}' title='Org eller personnummer utan - eller +. Juridiska personer inleds med 16' size='12' maxlength='12' required /><br/>
                        Inlämnarens Namn: <input type='text' name='namn' required /><br/>
                        Inlämnarens PostNr: <input type='text' name='postNr' pattern='[1-9][0-9]{4}' size='5' maxlength='5' required /><br/>
                        Inlämnarens PostOrt: <input type='text' name='postOrt' required /><br/>
                        <input type='submit' value='Generera INFO SRU' />
                    </form>
                </div>

                <div id='divBlankett' style='display: none'>
                    <form id='nyBlankettForm' onSubmit='return nyBlankett(this)'>
                        Blankett: 
                        <select name='blankettId'>
                                <option value="INK2R-2013P1">Räkenskapsschema INK2R 2013P1</option>
                                <option value="INK2S-2013P1">Skattemässiga justeringar INK2S 2013P1</option>
                        </select><br/>
                        OrgNr: <input type='text' name='orgNr' pattern='[1-2][0-9]{11}' title='Org eller personnummer utan - eller +. Juridiska personer inleds med 16' size='12' maxlength='12' required /><br/>
                        Namn: <input type='text' name='namn' /><br/>
                        <input type='submit' value='Lägg till ny blankett' />
                    </form>
                </div>

                <div id='divBlankettData' style='display: none'>
                    <form id='blankettDataForm' onSubmit='return fyllIBlankett(this)'>
                        <table id='tblUppgifter'></table>
                        <input type='submit' value='Lägg till uppgifter' />
                    </form>
                </div>

                <div id='divResultat' style='display: none'>
                        <h2>Genererade filer</h2>
                        <div>
                                <h3>INFO.SRU</h3>
                                <div id='infoSru'></div>
                                <a id='lnkInfoSru' target='_blank'>Ladda ner INFO.SRU</a>
                        </div>
                        <div id='divBlanketterSru' style='display: none'>
                                <h3>BLANKETTER.SRU</h3>
                                <div id='blanketterSru'></div>
                                <a id='lnkBlanketterSru' target='_blank'>Ladda ner BLANKETTER.SRU</a>
                        </div>
                </div>
                <script>
                        var fil = new Fil();
                        var nuvrandeBlankett = null;

                        function skapaInfoSruFil(form) {

                                var infoSru = genereraInfoSru(form[0].value,
                                                              form[1].value,
                                                              form[2].value,
                                                              form[3].value);
                                document.getElementById('divResultat').style.display = 'block';
                                document.getElementById('divBlankett').style.display = 'block';
                                document.getElementById('infoSru').innerHTML = infoSru;
                                
                                var formBlob = new Blob([infoSru.replace(/<br\/>/g,'\n')], { type: 'text/plain' });
                                document.getElementById('lnkInfoSru').href = window.URL.createObjectURL(formBlob);
                                return false;
                        }

                        function nyBlankett(form) {

                                var blankettId = form[0].value;

                                nuvrandeBlankett = new Blankett(blankettId, form[1].value);
                                if (form[2].value != "") {
                                        nuvrandeBlankett.infogaNamn(form[2].value);
                                }
                                fil.infogaBlankett(nuvrandeBlankett);

                                uppdateraMöjligaUppgifter(blankettId);

                                uppdateraBlanketterSru();

                                document.getElementById('divBlankettData').style.display = 'block';

                                return false;
                        }

                        function fyllIBlankett(form) {
                                for (var i = 0; i < (form.length - 1); i++) {
                                        if (form[i].value != "" && form[i].value != "0") {
                                                nuvrandeBlankett.nyUppgift(form[i].name, form[i].value);
                                        }
                                }
                                uppdateraBlanketterSru();
                                return false;
                        }

                        function uppdateraBlanketterSru() {
                                var blanketterSru = genereraBlanketterSru(fil);
                                document.getElementById('divBlanketterSru').style.display = 'block';
                                document.getElementById('blanketterSru').innerHTML = blanketterSru;

                                var formBlob = new Blob([blanketterSru.replace(/<br\/>/g,'\n')], { type: 'text/plain' });
                                document.getElementById('lnkBlanketterSru').href = window.URL.createObjectURL(formBlob);
                        }

                        function uppdateraMöjligaUppgifter(blankettId) {
                                var tillgängligaUppgifter = uppifter[blankettId] || [];
                                var tblBody = document.createElement("tbody");
                                var tr;

                                for (var i = 0; i < tillgängligaUppgifter.length; ++i) {
                                        if (i % 4 == 0) {
                                                tr = document.createElement('tr');
                                                tblBody.appendChild(tr);
                                        }

                                        var uppgift = tillgängligaUppgifter[i];

                                        var td = document.createElement('td');
                                        var label = document.createElement('label');
                                        label.for = uppgift.id;
                                        label.innerText = uppgift.namn;
                                        label.title = uppgift.id;

                                        var input = document.createElement('input');
                                        input.name = uppgift.id;
                                        input.id = uppgift.id;
                                        input.title = "(" + uppgift.id + ") ";

                                        if (uppgift.typ == "Str_X") {
                                                input.maxlength = 1;
                                                input.size = 1;
                                                input.pattern = '[X]?';
                                                input.type = 'text';
                                                input.title += "X eller blankt"
                                        } else if (uppgift.typ == "Numeriskt_A") {
                                                input.type = 'number';
                                                input.max = 99999999999;
                                                input.min = -99999999999;
                                                input.title += "Numeriskt mellan -999999999 och 999999999";
                                        } else if (uppgift.typ == "Numeriskt_B") {
                                                input.type = 'number';
                                                input.max = 99999999999;
                                                input.min = 0;
                                                input.title += "Numeriskt mellan 0 och 999999999";
                                        } else if (uppgift.typ == "Datum_A") {
                                                input.type = 'text';
                                                input.pattern = "[0-9]{8}";
                                                input.maxlength = 8;
                                                input.size = 8;
                                                input.title += "Datum YYYYMMDD";
                                        }
                                        
                                        td.appendChild(label);
                                        td.appendChild(input);
                                        tr.appendChild(td);
                                }

                                var tabell = document.getElementById('tblUppgifter');
                                if (tabell.lastChild != null) {
                                        tabell.removeChild(tabell.lastChild);
                                }
                                tabell.appendChild(tblBody);

                        }

                        var uppifter = { "INK2R-2013P1": [
                                {"id": 7001, "namn": "Första räkenskapsåret", "typ": "Str_X"}, 
                                {"id": 7002, "namn": "Andra räkenskapsåret",  "typ": "Str_X"}, 
                                {"id": 7011, "namn": "Räkenskapsår Fr.o.m",  "typ": "Datum_A"}, 
                                {"id": 7012, "namn": "Räkenskapsår T.o.m",  "typ": "Datum_A"}, 


                                {"id": 7201, "namn": "2.1", "typ": "Numeriskt_A"}, 
                                {"id": 7202, "namn": "2.2", "typ": "Numeriskt_A"}, 
                                
                                {"id": 7214, "namn": "2.3", "typ": "Numeriskt_A"}, 
                                {"id": 7215, "namn": "2.4", "typ": "Numeriskt_A"}, 
                                {"id": 7216, "namn": "2.5", "typ": "Numeriskt_A"}, 
                                {"id": 7217, "namn": "2.6", "typ": "Numeriskt_A"},

                                {"id": 7230, "namn": "2.7", "typ": "Numeriskt_A"},
                                {"id": 7231, "namn": "2.8", "typ": "Numeriskt_A"},
                                {"id": 7232, "namn": "2.9", "typ": "Numeriskt_A"},
                                {"id": 7233, "namn": "2.10", "typ": "Numeriskt_A"},
                                {"id": 7234, "namn": "2.11", "typ": "Numeriskt_A"},
                                {"id": 7235, "namn": "2.12", "typ": "Numeriskt_A"},
                                
                                {"id": 7241, "namn": "2.13", "typ": "Numeriskt_A"},
                                {"id": 7242, "namn": "2.14", "typ": "Numeriskt_A"},
                                {"id": 7243, "namn": "2.15", "typ": "Numeriskt_A"},
                                {"id": 7244, "namn": "2.16", "typ": "Numeriskt_A"},
                                {"id": 7245, "namn": "2.17", "typ": "Numeriskt_A"},
                                {"id": 7246, "namn": "2.18", "typ": "Numeriskt_A"},
                                
                                {"id": 7251, "namn": "2.19", "typ": "Numeriskt_A"},
                                {"id": 7252, "namn": "2.20", "typ": "Numeriskt_A"},
                                
                                {"id": 7261, "namn": "2.21", "typ": "Numeriskt_A"},
                                {"id": 7262, "namn": "2.22", "typ": "Numeriskt_A"},
                                {"id": 7263, "namn": "2.23", "typ": "Numeriskt_A"},
                                
                                {"id": 7270, "namn": "2.24", "typ": "Numeriskt_A"},
                                {"id": 7271, "namn": "2.25", "typ": "Numeriskt_A"},
                                
                                {"id": 7281, "namn": "2.26", "typ": "Numeriskt_A"},

                                {"id": 7301, "namn": "2.27", "typ": "Numeriskt_A"},
                                {"id": 7302, "namn": "2.28", "typ": "Numeriskt_A"},
                                
                                {"id": 7321, "namn": "2.29", "typ": "Numeriskt_A"},
                                {"id": 7322, "namn": "2.30", "typ": "Numeriskt_A"},
                                {"id": 7323, "namn": "2.31", "typ": "Numeriskt_A"},
                                
                                {"id": 7331, "namn": "2.32", "typ": "Numeriskt_A"},
                                {"id": 7332, "namn": "2.33", "typ": "Numeriskt_A"},
                                {"id": 7333, "namn": "2.34", "typ": "Numeriskt_A"},
                                
                                {"id": 7350, "namn": "2.35", "typ": "Numeriskt_A"},
                                {"id": 7351, "namn": "2.36", "typ": "Numeriskt_A"},
                                {"id": 7352, "namn": "2.37", "typ": "Numeriskt_A"},
                                {"id": 7353, "namn": "2.38", "typ": "Numeriskt_A"},
                                {"id": 7354, "namn": "2.39", "typ": "Numeriskt_A"},
                                
                                {"id": 7360, "namn": "2.40", "typ": "Numeriskt_A"},
                                {"id": 7361, "namn": "2.41", "typ": "Numeriskt_A"},
                                {"id": 7362, "namn": "2.42", "typ": "Numeriskt_A"},
                                {"id": 7363, "namn": "2.43", "typ": "Numeriskt_A"},
                                {"id": 7364, "namn": "2.44", "typ": "Numeriskt_A"},
                                {"id": 7365, "namn": "2.45", "typ": "Numeriskt_A"},
                                {"id": 7366, "namn": "2.46", "typ": "Numeriskt_A"},
                                {"id": 7367, "namn": "2.47", "typ": "Numeriskt_A"},
                                {"id": 7368, "namn": "2.48", "typ": "Numeriskt_A"},
                                {"id": 7369, "namn": "2.49", "typ": "Numeriskt_A"},
                                {"id": 7370, "namn": "2.50", "typ": "Numeriskt_A"},
                                
                                {"id": 7410, "namn": "3.1", "typ": "Numeriskt_A"},
                                
                                {"id": 7411, "namn": "3.2+", "typ": "Numeriskt_A"},
                                {"id": 7510, "namn": "3.2-", "typ": "Numeriskt_A"},
                                
                                {"id": 7412, "namn": "3.3", "typ": "Numeriskt_A"},
                                {"id": 7413, "namn": "3.4", "typ": "Numeriskt_A"},
                                {"id": 7511, "namn": "3.5", "typ": "Numeriskt_A"},
                                {"id": 7512, "namn": "3.6", "typ": "Numeriskt_A"},
                                {"id": 7513, "namn": "3.7", "typ": "Numeriskt_A"},
                                {"id": 7514, "namn": "3.8", "typ": "Numeriskt_A"},
                                {"id": 7515, "namn": "3.9", "typ": "Numeriskt_A"},
                                {"id": 7516, "namn": "3.10", "typ": "Numeriskt_A"},
                                {"id": 7517, "namn": "3.11", "typ": "Numeriskt_A"},
                                
                                {"id": 7414, "namn": "3.12+", "typ": "Numeriskt_A"},
                                {"id": 7518, "namn": "3.12-", "typ": "Numeriskt_A"},
                                
                                {"id": 7415, "namn": "3.13+", "typ": "Numeriskt_A"},
                                {"id": 7519, "namn": "3.13-", "typ": "Numeriskt_A"},
                                
                                {"id": 7416, "namn": "3.14+", "typ": "Numeriskt_A"},
                                {"id": 7520, "namn": "3.14-", "typ": "Numeriskt_A"},

                                {"id": 7417, "namn": "3.15", "typ": "Numeriskt_A"},
                                {"id": 7521, "namn": "3.16", "typ": "Numeriskt_A"},
                                {"id": 7522, "namn": "3.17", "typ": "Numeriskt_A"},
                                {"id": 7418, "namn": "3.18", "typ": "Numeriskt_A"},
                                {"id": 7523, "namn": "3.19", "typ": "Numeriskt_A"},
                                {"id": 7524, "namn": "3.20", "typ": "Numeriskt_A"},
                                {"id": 7419, "namn": "3.21", "typ": "Numeriskt_A"},
                                {"id": 7420, "namn": "3.22", "typ": "Numeriskt_A"},
                                {"id": 7525, "namn": "3.23", "typ": "Numeriskt_A"},
                                
                                {"id": 7421, "namn": "3.24+", "typ": "Numeriskt_A"},
                                {"id": 7526, "namn": "3.24-", "typ": "Numeriskt_A"},

                                {"id": 7422, "namn": "3.25+", "typ": "Numeriskt_A"},
                                {"id": 7527, "namn": "3.25-", "typ": "Numeriskt_A"},
                                
                                {"id": 7528, "namn": "3.26", "typ": "Numeriskt_A"},
                                {"id": 7450, "namn": "3.28=+", "typ": "Numeriskt_A"},
                                {"id": 7550, "namn": "3.29=-", "typ": "Numeriskt_A"}],
                                
                                "INK2S-2013P1": [
                                {"id": 7001, "namn": "Första räkenskapsåret", "typ": "Str_X"}, 
                                {"id": 7002, "namn": "Andra räkenskapsåret", "typ": "Str_X"}, 
                                {"id": 7011, "namn": "Räkenskapsår Fr.o.m",  "typ": "Datum_A"}, 
                                {"id": 7012, "namn": "Räkenskapsår T.o.m",  "typ": "Datum_A"}, 

                                {"id": 7650, "namn": "4.1", "typ": "Numeriskt_B"},
                                {"id": 7750, "namn": "4.2", "typ": "Numeriskt_B"},
                                
                                {"id": 7651, "namn": "4.3a", "typ": "Numeriskt_A"},
                                {"id": 7652, "namn": "4.3b", "typ": "Numeriskt_A"},
                                {"id": 7653, "namn": "4.3c", "typ": "Numeriskt_A"},
                                
                                {"id": 7751, "namn": "4.4a", "typ": "Numeriskt_A"},
                                {"id": 7764, "namn": "4.4b", "typ": "Numeriskt_A"},
                                
                                {"id": 7752, "namn": "4.5a", "typ": "Numeriskt_A"},
                                {"id": 7753, "namn": "4.5b", "typ": "Numeriskt_A"},
                                {"id": 7754, "namn": "4.5c", "typ": "Numeriskt_A"},
                                
                                {"id": 7654, "namn": "4.6a", "typ": "Numeriskt_A"},
                                {"id": 7668, "namn": "4.6b", "typ": "Numeriskt_A"},
                                {"id": 7655, "namn": "4.6c", "typ": "Numeriskt_A"},
                                {"id": 7667, "namn": "4.6d", "typ": "Numeriskt_A"},
                                {"id": 7665, "namn": "4.6e", "typ": "Numeriskt_A"},
                                
                                {"id": 7755, "namn": "4.7a", "typ": "Numeriskt_B"},
                                {"id": 7656, "namn": "4.7b", "typ": "Numeriskt_B"},
                                {"id": 7756, "namn": "4.7c", "typ": "Numeriskt_B"},
                                {"id": 7657, "namn": "4.7d", "typ": "Numeriskt_B"},
                                {"id": 7658, "namn": "4.7e", "typ": "Numeriskt_B"},
                                {"id": 7757, "namn": "4.7f", "typ": "Numeriskt_B"},
                                
                                {"id": 7758, "namn": "4.8a", "typ": "Numeriskt_B"},
                                {"id": 7659, "namn": "4.8b", "typ": "Numeriskt_B"},
                                {"id": 7660, "namn": "4.8c", "typ": "Numeriskt_B"},
                                {"id": 7759, "namn": "4.8d", "typ": "Numeriskt_B"},

                                {"id": 7666, "namn": "4.9+", "typ": "Numeriskt_B"},
                                {"id": 7765, "namn": "4.9-", "typ": "Numeriskt_B"},

                                {"id": 7661, "namn": "4.10+", "typ": "Numeriskt_B"},
                                {"id": 7760, "namn": "4.10-", "typ": "Numeriskt_B"},
                                
                                {"id": 7761, "namn": "4.11", "typ": "Numeriskt_A"},
                                {"id": 7662, "namn": "4.12", "typ": "Numeriskt_A"},
                                
                                {"id": 7663, "namn": "4.13+", "typ": "Numeriskt_B"},
                                {"id": 7762, "namn": "4.13-", "typ": "Numeriskt_B"},
                                
                                {"id": 7763, "namn": "4.14a", "typ": "Numeriskt_A"},
                                {"id": 7664, "namn": "4.14b", "typ": "Numeriskt_A"},
                                
                                {"id": 7670, "namn": "4.15=+", "typ": "Numeriskt_B"},
                                {"id": 7770, "namn": "4.16=-", "typ": "Numeriskt_B"},
                                
                                {"id": 8020, "namn": "4.17", "typ": "Numeriskt_A"},
                                {"id": 8021, "namn": "4.18", "typ": "Numeriskt_A"},
                                {"id": 8023, "namn": "4.19", "typ": "Numeriskt_B"},
                                {"id": 8026, "namn": "4.20", "typ": "Numeriskt_B"},
                                
                                {"id": 8040, "namn": "Redovisningskonsult JA", "typ": "Str_X"},
                                {"id": 8041, "namn": "Redovisningskonsult NEJ", "typ": "Str_X"},

                                {"id": 8044, "namn": "Revision JA", "typ": "Str_X"},
                                {"id": 8045, "namn": "Revision NEJ", "typ": "Str_X"}]
                        };

                </script>
        </body>
</html>
